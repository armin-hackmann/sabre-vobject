<?php

namespace Sabre\VObject\ITip;

class Issue152Test extends BrokerTester {

    function testInviteAddInsignificantDataToANewExdate() {

        $oldMessage = <<<ICS
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Apple Inc.//Mac OS X 10.10.4//EN
CALSCALE:GREGORIAN
BEGIN:VEVENT
CREATED:20150611T094241Z
UID:foobar
RRULE:FREQ=DAILY;INTERVAL=1;UNTIL=20150617T215959Z
DTEND:20150611T140000Z
ORGANIZER;CN=Strunk:mailto:strunk@example.org
ATTENDEE;CN=Strunk;CUTYPE=INDIVIDUAL;EMAIL=strunk@example.org;PARTSTAT=ACCE
 PTED;ROLE=CHAIR:mailto:strunk@example.org
ATTENDEE;CN=One;CUTYPE=INDIVIDUAL;EMAIL=one@example.org;PARTSTAT=ACCEPTED;R
 OLE=REQ-PARTICIPANT;SCHEDULE-STATUS="1.2;Message delivered locally":mailto
 :one@example.org
TRANSP:OPAQUE
SUMMARY:foo
DTSTART:20150611T130000Z
DTSTAMP:20150611T094241Z
SEQUENCE:0
END:VEVENT
END:VCALENDAR
ICS;


        $newMessage = <<<ICS
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Apple Inc.//Mac OS X 10.10.4//EN
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:foobar
ORGANIZER;CN=Strunk:mailto:strunk@example.org
ATTENDEE;CN=Strunk;CUTYPE=INDIVIDUAL;EMAIL=strunk@example.org;PARTSTAT=ACCE
 PTED;ROLE=CHAIR:mailto:strunk@example.org
ATTENDEE;CN=One;CUTYPE=INDIVIDUAL;EMAIL=one@example.org;PARTSTAT=ACCEPTED;R
 OLE=REQ-PARTICIPANT;SCHEDULE-STATUS=1.2:mailto:one@example.org
DTEND:20150611T140000Z
TRANSP:OPAQUE
DTSTAMP:20150611T094241Z
SEQUENCE:0
SUMMARY:foo
DTSTART:20150611T130000Z
CREATED:20150611T094241Z
RRULE:FREQ=DAILY;INTERVAL=1;UNTIL=20150617T215959Z
END:VEVENT
BEGIN:VEVENT
CREATED:20150611T094241Z
UID:foobar
DTEND:20150612T140000Z
TRANSP:OPAQUE
ORGANIZER;CN=Strunk:mailto:strunk@example.org
ATTENDEE;CN=Strunk;CUTYPE=INDIVIDUAL;EMAIL=strunk@example.org;PARTSTAT=ACCE
 PTED;ROLE=CHAIR:mailto:strunk@example.org
ATTENDEE;CN=One;CUTYPE=INDIVIDUAL;EMAIL=one@example.org;PARTSTAT=ACCEPTED;R
 OLE=REQ-PARTICIPANT;SCHEDULE-STATUS=1.2:mailto:one@example.org
DTSTART:20150612T130000Z
DTSTAMP:20150611T094241Z
SEQUENCE:0
RECURRENCE-ID:20150612T130000Z
BEGIN:VALARM
X-WR-ALARMUID:04161D3B-4342-4B4D-8D8E-C5F59EEAA7A3
UID:04161D3B-4342-4B4D-8D8E-C5F59EEAA7A3
TRIGGER:-PT30M
DESCRIPTION:Erinnerung an ein Ereignis
ACTION:DISPLAY
END:VALARM
END:VEVENT
END:VCALENDAR
ICS;

        $version = \Sabre\VObject\Version::VERSION;

        $expected = array(
            array(
                'uid' => 'foobar',
                'method' => 'REQUEST',
                'component' => 'VEVENT',
                'sender' => 'mailto:strunk@example.org',
                'senderName' => 'Strunk',
                'recipient' => 'mailto:one@example.org',
                'recipientName' => 'One',
                'significantChange' => false,
                'message' => <<<ICS
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Sabre//Sabre VObject $version//EN
CALSCALE:GREGORIAN
METHOD:REQUEST
BEGIN:VEVENT
UID:foobar
ORGANIZER;CN=Strunk:mailto:strunk@example.org
ATTENDEE;CN=Strunk;CUTYPE=INDIVIDUAL;EMAIL=strunk@example.org;PARTSTAT=ACCE
 PTED;ROLE=CHAIR:mailto:strunk@example.org
ATTENDEE;CN=One;CUTYPE=INDIVIDUAL;EMAIL=one@example.org;PARTSTAT=ACCEPTED;R
 OLE=REQ-PARTICIPANT:mailto:one@example.org
DTEND:20150611T140000Z
TRANSP:OPAQUE
DTSTAMP:20150611T094241Z
SEQUENCE:0
SUMMARY:foo
DTSTART:20150611T130000Z
CREATED:20150611T094241Z
RRULE:FREQ=DAILY;INTERVAL=1;UNTIL=20150617T215959Z
END:VEVENT
BEGIN:VEVENT
CREATED:20150611T094241Z
UID:foobar
DTEND:20150612T140000Z
TRANSP:OPAQUE
ORGANIZER;CN=Strunk:mailto:strunk@example.org
ATTENDEE;CN=Strunk;CUTYPE=INDIVIDUAL;EMAIL=strunk@example.org;PARTSTAT=ACCE
 PTED;ROLE=CHAIR:mailto:strunk@example.org
ATTENDEE;CN=One;CUTYPE=INDIVIDUAL;EMAIL=one@example.org;PARTSTAT=ACCEPTED;R
 OLE=REQ-PARTICIPANT;SCHEDULE-STATUS=1.2:mailto:one@example.org
DTSTART:20150612T130000Z
DTSTAMP:20150611T094241Z
SEQUENCE:0
RECURRENCE-ID:20150612T130000Z
BEGIN:VALARM
X-WR-ALARMUID:04161D3B-4342-4B4D-8D8E-C5F59EEAA7A3
UID:04161D3B-4342-4B4D-8D8E-C5F59EEAA7A3
TRIGGER:-PT30M
DESCRIPTION:Erinnerung an ein Ereignis
ACTION:DISPLAY
END:VALARM
END:VEVENT
END:VCALENDAR
ICS
            ),
        );

        $this->parse($oldMessage, $newMessage, $expected, 'mailto:strunk@example.org');

    }
}
